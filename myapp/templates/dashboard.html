{% load static %}
<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
</head>
<body>
    



<div class="dash-wrapper">

    <aside class="right-sidebar">
        <div class="profile-box">
            {% if request.user.profile.avatar %}
    <img src="{{ request.user.profile.avatar.url }}" class="avatar" alt="Avatar">
{% endif %}
        

            <h3>{{ request.user.first_name }} {{ request.user.last_name }}</h3>
            <p>{{ request.user.email }}</p>
        </div>

        <ul class="menu">
            <li onclick="showTab('home')" class="active">Dashboard</li>
            <li onclick="showTab('search')">Search Courses</li>
            <li onclick="showTab('mycourses')">My Courses</li>
            <li onclick="showTab('edit_profile')">Edit Profile</li>
            <li onclick="showTab('change_password')">Change Password</li>
            <li><a class="logout" href="{% url 'logout_user' %}">Logout</a></li>
        </ul>
    </aside>

   
    <main class="dash-content">

     
        <section id="home" class="tab-section">
    <h1 class="title">Welcome back, {{ request.user.first_name }}! ðŸ‘‹</h1>

    <div class="user-details-card">
        <h2>Your Profile Details</h2>

        <div class="details-grid">
            <p><strong>Full Name:</strong> {{ request.user.first_name }} {{ request.user.last_name }}</p>
            <p><strong>Email:</strong> {{ request.user.email }}</p>
            <p><strong>Phone:</strong> {{ request.user.profile.phone }}</p>
            <p><strong>City:</strong> {{ request.user.profile.city }}</p>
            <p><strong>State:</strong> {{ request.user.profile.state }}</p>
            <p><strong>Country:</strong> {{ request.user.profile.country }}</p>
            <p><strong>Hobbies:</strong> {{ request.user.profile.hobbies }}</p>
            {% if profile.avatar %}
                <img src="{{ profile.avatar.url }}" alt="Avatar" width="100">
            {% endif %}
        </div>
    </div>
</section>

     
        <section id="search" class="tab-section hidden">
            <h2 class="title">Search Courses</h2>

            <form method="GET" class="search-form">
                <input type="text" name="search" value="{{ query }}" placeholder="Search for a courseâ€¦">
                <button class="btn-orange">Search</button>
            </form>

            <div class="course-grid">
                {% for c in courses %}
                <div class="card course-card">
                    <h3>{{ c.name }}</h3>
                    <p>Duration: {{ c.duration }}</p>
                    <p>Fee: â‚¹{{ c.fee }}</p>

                    <form method="POST" action="{% url 'signedup_course' c.id %}">
                        {% csrf_token %}
                        <button class="btn-blue">Sign Up</button>
                    </form>
                </div>
                {% empty %}
                <p>No courses found</p>
                {% endfor %}
            </div>
        </section>

    
        <section id="mycourses" class="tab-section hidden">
            <h2 class="title">My Courses</h2>

            <div class="course-grid">
                {% for c in my_courses %}
                <div class="card mycourse-card">
                    <h3>{{ c.course.name }}</h3>
                    <p>{{ c.course.duration }}</p>
                    <p>â‚¹{{ c.course.fee }}</p>
                     <form method="POST" action="{% url 'remove_course' c.id %}">
                        {% csrf_token %}
                        <button class="btn-blue">remove</button>
                    </form>
                </div>
                {% empty %}
                <p>You haven't signed up for any course yet.</p>
                {% endfor %}
            </div>
        </section>
        <section id="edit_profile" class="tab-section hidden">
    <div class="form-box">
        <h2>Edit Profile</h2>

        <form method="POST" enctype="multipart/form-data" action="{% url 'edit_profile' %}" class="details_form">
            {% csrf_token %}

            <label>First Name</label>
            <input type="text" name="first_name" value="{{ request.user.first_name }}">
            <br><br>
            <label>Last Name</label>
            <input type="text" name="last_name" value="{{ request.user.last_name }}">

            <label>Phone</label>
            <input type="text" name="phone" value="{{ request.user.profile.phone }}">
            
            <label>City</label>
            <input type="text" name="city" value="{{ request.user.profile.city }}">

            <label>State</label>
            <input type="text" name="state" value="{{ request.user.profile.state }}">

            <label>Country</label>
            <input type="text" name="country" value="{{ request.user.profile.country }}">

            <label>Hobbies</label>
            <input type="text" name="hobbies" value="{{ request.user.profile.hobbies }}">

            <label>Avatar</label>
            <input type="file" name="avatar">

            <button>Save Changes</button>
        </form>
    </div>
</section>
<section id="change_password" class="tab-section hidden">
    <div class="form-box">
        <h2>Change Password</h2>

        <form method="POST" action="{% url 'change_password' %}">
            {% csrf_token %}

            <label>Current Password</label>
            <input type="password" name="old_password">

            <label>New Password</label>
            <input type="password" name="new_password">

            <label>Confirm Password</label>
            <input type="password" name="confirm_password">

            <button>Update Password</button>
        </form>
    </div>
</section>



    </main>
</div>

<script>
function showTab(tabId) {
    document.querySelectorAll('.tab-section').forEach(t => t.classList.add('hidden'));
    document.getElementById(tabId).classList.remove('hidden');

    document.querySelectorAll('.menu li').forEach(li => li.classList.remove('active'));
    event.target.classList.add('active');
}
document.addEventListener('DOMContentLoaded',function(){
    let activeTab = "{{ active_tab }}";  
    showTab(activeTab);
})
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

{% if messages %}
<script>
    {% for message in messages %}
        Swal.fire({
            title: "{{ message.tags|capfirst }}",
            text: "{{ message }}",
            icon: "{{ message.tags }}"
        });
    {% endfor %}
</script>
{% endif %}

</body>
</html>